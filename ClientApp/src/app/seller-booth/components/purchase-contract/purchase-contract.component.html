
<div class="context-container">
    <mat-chip-list> </mat-chip-list>
    <div fxLayout="row" fxLayoutAlign="center start">
  
      <mat-card fxFlex="60">
        <mat-card-title class="text-center"
          >Seller Booth Merchandiser
        </mat-card-title>
  
        <mat-card-subtitle>
          Create New Purchase Contract
        </mat-card-subtitle>
  
        <form [formGroup]="frmGroup" novalidate>
  
          <mat-card-content>
            <div fxLayout="row" fxLayoutGap="6px">
              <span class="red-color">*</span>
              <div class="mat-caption text-muted">required fields</div>
            </div>
  
            <div fxLayout="row" fxLayoutAlign="start center">
              <mat-form-field [color]="'accent'" fxFlex>
                <input matInput placeholder="Title *" formControlName="title" />
                <mat-error *ngIf="required('title')">Value is required</mat-error>
              </mat-form-field>
            </div>
  
            <div fxLayout="row" fxLayoutAlign="start center">
              <mat-form-field [color]="'accent'" fxFlex>
                <input matInput placeholder="Price *" formControlName="price" />
                <span matPrefix>$ETH:&nbsp;&nbsp;</span>
                <span matSuffix>(#.####)</span>
                <mat-error *ngIf="required('price')">Value is required</mat-error>
                <mat-error *ngIf="invalidPattern('price')"
                  >Invalid price format value</mat-error
                >
              </mat-form-field>
            </div>
           </mat-card-content>
  
           <input type="file" #file style="display: none" (change)="onFileChange($event)"/>
           
          <mat-card-actions>
              <button mat-raised-button color="primary" (click)="selectFile()">
                Select Product Image
                <mat-icon>category</mat-icon>
              </button>
              
              <button mat-raised-button color="accent" *ngIf="fileModel"
                (click)="uploadFile()"
                [disabled]="formControl('fileArg').invalid">
                Upload To IPFS
                <mat-icon>offline_bolt</mat-icon>
              </button> 

          </mat-card-actions>
  
         
          <mat-card-content *ngIf="fileModel">
  
              <div fxLayout="row" fxLayoutAlign="start center">
  
                <div fxFlex="25" class="text-center">Image</div>
                <div fxFlex="25" class="text-center">File</div>
                <div fxFlex class="text-center">IPFS Hash</div>
                <div fxFlex="15" class="text-center">Status</div>
              </div> 
            
            <br>
            
            
            <div fxLayout="row" fxLayoutAlign="start center">
  
                <div fxFlex="25" class="text-center">
                    <img matLine [src]="fileContent" height="200" width="200" />
                </div>
  
                <div fxFlex="25" class="text-center">
                    <mat-list>
                        <mat-list-item >
                          <h3 matLine> {{fileModel.name }} </h3>
                          <p matLine>
                            <mat-error mat-line *ngIf="requiredFile('fileArg')">You must choose a file</mat-error >
                            <mat-error mat-line *ngIf="invalidPatternFile('fileArg')">Invalid file image extension</mat-error>
                          </p>
                        </mat-list-item>
                      </mat-list>
                </div>
  
                <div fxFlex class="text-center">
                    {{ipfsHash$ | async}}
                </div>

                <div fxFlex="15" class="text-center">
                  
                  <div *ngIf="(uploadStatus$ | async) as status;">

                  
                    <div *ngIf="inProgress(status); else idle">
                        <mat-progress-spinner 
                          color="warn"
                          mode="indeterminate"
                          value="50"
                          diameter="50"
                          strokeWidth="5">
                      </mat-progress-spinner>
                    </div>
                    
                    <ng-template #idle>
                        <mat-chip *ngIf="isPending(status)">{{ status }}</mat-chip>
                        <mat-chip *ngIf="isSuccess(status)" selected="true" color="accent">
                          {{ status }}
                        </mat-chip>
                        <mat-chip *ngIf="isError(status)" selected="true" color="warn" >
                          {{status}}
                        </mat-chip>
                    </ng-template>

                </div>
              
                </div>
    
              </div>
  
          </mat-card-content>

          <!-- 
  
            <mat-card-content>
              Control invalid: {{ formControl('fileArg').invalid | json}}
              <br>
              Control pristine: {{ formControl('fileArg').pristine | json}}
          </mat-card-content>
          -->
      
        </form>
      </mat-card>
    </div>
  </div>
  

